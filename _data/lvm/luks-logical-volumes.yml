storage:
  has-raid1: false
  has-swapfile: false
  has-detached-header: false

  devices:
    - id: 1
      node: /dev/sda

    - id: 2
      node: /dev/sdb

  partitions:
    - node: /dev/sda1
      is-firmware: true
      label: EFI

    - node: /dev/sda2
      is-firmware: false
      type: Linux LVM
      size: 100%FREE

    - node: /dev/sdb1
      is-firmware: false
      type: Linux LVM
      size: 100%FREE

  containers:
    - name: root
      node: /dev/grp/cryptroot
      mapper: /dev/mapper/root
      keyfile: cryptroot.keyfile

    - name: home
      node: /dev/grp/crypthome
      mapper: /dev/mapper/home
      keyfile: crypthome.keyfile

  lvm:
    has-encrypted-volumes: true
    pv: /dev/sda2 /dev/sdb1
    vg: grp
    lvs:
      - name: root
        label: CRYPTROOT
        has-dir: false
        node: /dev/grp/cryptroot
        size: 20G
        size-arg: -L

      - name: swap
        label: CRYPTSWAP
        has-dir: false
        node: /dev/grp/cryptswap
        size: "> 512M"
        size-arg: -L

      - name: home
        label: CRYPTHOME
        has-dir: true
        node: /dev/grp/crypthome
        size: 100%FREE
        size-arg: -l

package:
  lvm: lvm2

script:
  sgdisk:
    - args: -n=2:0:0 -t=2:8e00 /dev/sda
      is-primary: true

    - args: -o -n=1:0:0 -t=1:8e00 /dev/sdb
      is-primary: false

configuration:
  mkinitcpio: |
    FILES=(/etc/luks-key/cryptroot.keyfile)
    HOOKS=(base udev autodetect modconf block encrypt lvm2 filesystems keyboard keymap fsck)
  grub: |
    GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=/dev/grp/cryptroot:root cryptkey=rootfs:/etc/luks-keys/cryptroot.keyfile root=/dev/mapper/root loglevel=3 quiet"
    GRUB_ENABLE_CRYPTODISK=y
