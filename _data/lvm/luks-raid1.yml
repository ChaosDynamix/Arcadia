storage:
  has-raid1: true
  has-swapfile: false
  has-detached-header: false

  devices:
    - id: 1
      node: /dev/sda

    - id: 2
      node: /dev/sdb

  partitions:
    - node: /dev/sda1
      is-firmware: true

    - node: /dev/sda2
      is-firmware: false
      type: Linux RAID partition
      size: 100%FREE - 100M

    - node: /dev/sdb1
      is-firmware: true

    - node: /dev/sdb2
      is-firmware: false
      type: Linux RAID partition
      size: 100%FREE - 100M

  containers:
    - name: cryptlvm
      node: /dev/md/array
      mapper: /dev/mapper/cryptlvm
      keyfile: cryptlvm.keyfile

  lvm:
    has-encrypted-volumes: false
    pv: /dev/mapper/cryptlvm
    vg: grp
    lvs:
      - label: ROOT
        is-swap: false
        is-root: true
        has-dir: false
        node: /dev/grp/root
        size: 20G
        size-arg: -L

      - label: SWAP
        is-swap: true
        is-root: false
        has-dir: false
        node: /dev/grp/swap
        size: "> 512M"
        size-arg: -L

      - label: VAR
        is-swap: false
        is-root: false
        has-dir: true
        node: /dev/grp/var
        size: 10G
        size-arg: -L

      - label: HOME
        is-swap: false
        is-root: false
        has-dir: true
        node: /dev/grp/home
        size: 100%FREE - 5G
        size-arg: -l

packages:
  - name: lvm2
  - name: mdadm

script:
  sgdisk:
    - args: -n=2:0:-100M -t=2:fd00 -R=/dev/sdb /dev/sda
      is-primary: true

    - args: -G /dev/sdb
      is-primary: false

configuration:
  mkinitcpio: |
    FILES=(/etc/luks-key/cryptlvm.keyfile)
    HOOKS=(base udev autodetect modconf block mdadm_udev encrypt lvm2 filesystems keyboard keymap fsck)
  grub: |
    GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=/dev/md/array:cryptlvm cryptkey=rootfs:/etc/luks-keys/cryptlvm.keyfile root=/dev/grp/root loglevel=3 quiet"
    GRUB_ENABLE_CRYPTODISK=y
