has_raid        : !!bool true
has_encryption  : !!bool true
has_lvm         : !!bool true
has_swapfile    : !!bool false

# PROFILE
profile : !!map
  partitioning    : !!str luks_mirroring_raid
  installation    : !!str raid_lvm
  initialization  : !!str busybox_luks_lvm
  devices_table   : !!str none

# STORAGE
devices : !!seq
  - !!map
    node  : !!str /dev/sda
  - !!map
    node  : !!str /dev/sdb

partitions  : !!seq
  - !!map
    node      : !!str /dev/sda1
    has_boot  : !!bool true
  - !!map
    node      : !!str /dev/sda2
    has_boot  : !!bool false
    type      : !!str Linux RAID partition
    size      : !!str 100%FREE - 100M
  - !!map
    node      : !!str /dev/sdb1
    has_boot  : !!bool true
  - !!map
    node      : !!str /dev/sdb2
    has_boot  : !!bool false
    type      : !!str Linux RAID partition
    size      : !!str 100%FREE - 100M

# RAID
raid  : !!map
  level : !!int 1
  array : !!map
    efi     : !!str /dev/md/efi
    system  : !!str /dev/md/lvm

# STEPS
steps  : !!seq
  - !!map
    id              : !!int 1
    encryption_ctx  : !!str system Raid array
    filesystem_ctx  : !!str volumes

# ENCRYPTION
containers  : !!seq
  - !!map
    id                  : !!int 1
    step_id             : !!int 1
    is_bootable         : !!bool true
    name                : !!str cryptlvm
    node                : !!str /dev/md/lvm
    type                : !!str luks1
    has_detached_header : !!bool false
    has_keyfile         : !!bool true
    keyfile             : !!str /etc/luks-keys/cryptlvm.keyfile

# LOGICAL VOLUME MANAGER
lvm : !!map
  pv  : !!str /dev/mapper/cryptlvm
  vg  : !!str grp
  lvs : !!seq
    - !!map
      node  : !!str /dev/grp/root
      name  : !!str root
      size  : !!str "15-20 GiB"
    - !!map
      node  : !!str /dev/grp/swap
      name  : !!str swap
      size  : !!str "> 512 MiB"
    - !!map
      node  : !!str /dev/grp/var
      name  : !!str var
      size  : !!str "8-12 GiB"
    - !!map
      node  : !!str /dev/grp/home
      name  : !!str home
      size  : !!str "100%FREE - 5 GiB"

# FILESYSTEM
filesystem  : !!map
  name    : !!str ext4
  configs : !!seq
    - !!map
      step_id     : !!int 1
      has_swap    : !!bool true
      format_cmd  : !!str |
                    $ mkfs.ext4 -L ROOT /dev/grp/root
                    $ mkfs.ext4 -L VAR /dev/grp/var
                    $ mkfs.ext4 -L HOME /dev/grp/home
      mount_cmd   : !!str |
                    $ mount /dev/grp/root /mnt
                    $ mkdir /mnt/{var,home}
                    $ mount /dev/grp/var /mnt/var
                    $ mount /dev/grp/home /mnt/home
      swap_cmd    : !!str |
                    $ mkswap -L SWAP /dev/grp/swap
                    $ swapon /dev/grp/swap
