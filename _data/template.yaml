####################################
# LUKS ON SINGLE PARTITION         #
####################################

luks_single_partition     : !!map
  init_system : !!str busybox
  has_raid    : !!bool false

  devices     : !!seq
    - !!map
      node  : !!str /dev/sda

  partitions  : !!seq
    - !!map
      node  : !!str /dev/sda1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sda2
      type  : !!str Linux LUKS partition
      size  : !!str 100%FREE

  efi       : !!map
    context : !!str partition
    node    : !!str /dev/sda1

  has_encryption  : !!bool true
  encryption      : !!map
    headerless    : !!bool false
    steps         : !!seq
      - !!map
        id        : !!int 1
        context   : !!str partition
    containers    : !!seq
      - !!map
        step_id   : !!int 1
        init_key  : !!bool false
        bootable  : !!bool true
        node      : !!str /dev/sda2
        name      : !!str crypt_context_
        keyfile   : !!str /etc/luks-keys/crypt_context_.keyfile

  sgdisk    : !!str |
              $ sgdisk -o mode_sgdisk -n=2:0:0 -t=2:8309 /dev/sda

  has_fstab               : !!bool false
  has_crypttab            : !!bool false
  has_crypttab_initramfs  : !!bool false

  mkinitcpio: !!map
    hooks : !!str base udev autodetect modconf block encrypt lvm2 filesystems keyboard keymap fsck

  grub_configuration  : !!str |
                        GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=UUID=7b38f0ff-08a5-463d-8c18-e4386b89721e:crypt_context_:allow-discards cryptkey=rootfs:/etc/luks-keys/crypt_context_.keyfile root=/dev/grp/root loglevel=3 quiet"
                        GRUB_ENABLE_CRYPTODISK=y

####################################
# LUKS ON MULTIPLE PARTITIONS      #
####################################

luks_multiple_partitions  : !!map
  init_system : !!str systemd
  has_raid    : !!bool false

  devices     : !!seq
    - !!map
      node  : !!str /dev/sda
    - !!map
      node  : !!str /dev/sdb

  partitions  : !!seq
    - !!map
      node  : !!str /dev/sda1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sda2
      type  : !!str Linux LUKS partition
      size  : !!str 100%FREE
    - !!map
      node  : !!str /dev/sdb1
      type  : !!str Linux LUKS partition
      size  : !!str 100%FREE

  efi       : !!map
    context : !!str partition
    node    : !!str /dev/sda1

  has_encryption  : !!bool true
  encryption      : !!map
    headerless    : !!bool false
    steps         : !!seq
      - !!map
        id        : !!int 1
        context   : !!str partitions
    containers    : !!seq
      - !!map
        step_id   : !!int 1
        init_key  : !!bool false
        bootable  : !!bool true
        node      : !!str /dev/sda2
        name      : !!str crypt_context_1
        keyfile   : !!str /etc/luks-keys/crypt_context_1.keyfile
      - !!map
        step_id   : !!int 1
        init_key  : !!bool false
        bootable  : !!bool true
        node      : !!str /dev/sdb1
        name      : !!str crypt_context_2
        keyfile   : !!str /etc/luks-keys/crypt_context_2.keyfile

  sgdisk    : !!str |
              $ sgdisk -o mode_sgdisk -n=2:0:0 -t=2:8309 /dev/sda
              $ sgdisk -o -n=1:0:0 -t=1:8309 /dev/sdb

  has_fstab               : !!bool false
  has_crypttab            : !!bool false
  has_crypttab_initramfs  : !!bool true
  crypttab_initramfs      : !!str |
                            crypt_context_1     UUID=device_UUID   /etc/luks-keys/crypt_context_1.keyfile
                            crypt_context_2     UUID=device_UUID   /etc/luks-keys/crypt_context_2.keyfile

  mkinitcpio: !!map
    hooks : !!str base systemd autodetect modconf block sd-encrypt sd-lvm2 filesystems keyboard sd-vconsole fsck

  grub_configuration  : !!str |
                        GRUB_CMDLINE_LINUX_DEFAULT="rd.luks.options=discard root=/dev/grp/root loglevel=3 quiet"
                        GRUB_ENABLE_CRYPTODISK=y

####################################
# LUKS ON RAID                     #
####################################

luks_raid                 : !!map
  init_system : !!str busybox
  has_raid    : !!bool true

  devices     : !!seq
    - !!map
      node  : !!str /dev/sda
    - !!map
      node  : !!str /dev/sdb

  partitions  : !!seq
    - !!map
      node  : !!str /dev/sda1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sda2
      type  : !!str Linux RAID partition
      size  : !!str 100%FREE - 100M
    - !!map
      node  : !!str /dev/sdb1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sdb2
      type  : !!str Linux RAID partition
      size  : !!str 100%FREE - 100M

  efi       : !!map
    context : !!str array
    node    : !!str /dev/md/efi

  has_encryption  : !!bool true
  encryption      : !!map
    headerless    : !!bool false
    steps         : !!seq
      - !!map
        id        : !!int 1
        context   : !!str system Raid array
    containers    : !!seq
      - !!map
        step_id   : !!int 1
        init_key  : !!bool false
        bootable  : !!bool true
        node      : !!str /dev/md/system
        name      : !!str crypt_context_
        keyfile   : !!str /etc/luks-keys/crypt_context_.keyfile

  sgdisk    : !!str |
              $ sgdisk -o mode_sgdisk -n=2:0:-100M -t=2:fd00 -R=/dev/sdb /dev/sda
              $ sgdisk -G /dev/sdb

  has_fstab               : !!bool false
  has_crypttab            : !!bool false
  has_crypttab_initramfs  : !!bool false

  mkinitcpio: !!map
    hooks : !!str base udev autodetect modconf block mdadm_udev encrypt lvm2 filesystems keyboard keymap fsck

  grub_configuration  : !!str |
                        GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=UUID=7b38f0ff-08a5-463d-8c18-e4386b89721e:crypt_context_:allow-discards cryptkey=rootfs:/etc/luks-keys/crypt_context_.keyfile root=/dev/grp/root loglevel=3 quiet"
                        GRUB_ENABLE_CRYPTODISK=y

####################################
# LUKS ON LOGICAL VOLUMES          #
####################################

luks_logical_volumes      : !!map
  init_system : !!str busybox
  has_raid    : !!bool false

  devices     : !!seq
    - !!map
      node  : !!str /dev/sda
    - !!map
      node  : !!str /dev/sdb

  partitions  : !!seq
    - !!map
      node  : !!str /dev/sda1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sda2
      type  : !!str Linux LVM
      size  : !!str 100%FREE
    - !!map
      node  : !!str /dev/sdb1
      type  : !!str Linux LVM
      size  : !!str 100%FREE

  efi       : !!map
    context : !!str partition
    node    : !!str /dev/sda1

  has_encryption  : !!bool true
  encryption      : !!map
    headerless    : !!bool false
    steps         : !!seq
      - !!map
        id        : !!int 1
        context   : !!str Root container
      - !!map
        id        : !!int 2
        context   : !!str Home container
    containers    : !!seq
      - !!map
        step_id   : !!int 1
        init_key  : !!bool false
        bootable  : !!bool true
        node      : !!str /dev/grp/cryptroot
        name      : !!str root
        keyfile   : !!str /etc/luks-keys/cryptroot.keyfile
      - !!map
        step_id   : !!int 2
        init_key  : !!bool true
        bootable  : !!bool false
        node      : !!str /dev/grp/crypthome
        name      : !!str home
        keyfile   : !!str /etc/luks-keys/crypthome.keyfile

  sgdisk    : !!str |
              $ sgdisk -o mode_sgdisk -n=2:0:0 -t=2:8e00 /dev/sda
              $ sgdisk -o -n=1:0:0 -t=1:8e00 /dev/sdb

  has_fstab     : !!bool true
  fstab         : !!str |
                  /dev/mapper/swap    none    swap    sw          0 0
                  /dev/mapper/home    /home   ext4    defaults    0 2
  has_crypttab  : !!bool true
  crypttab      : !!str |
                  swap    /dev/grp/cryptswap     /dev/urandom          swap,cipher=aes-xts-plain64,size=256
                  home    /dev/grp/crypthome     /etc/luks-keys/crypthome.keyfile

  has_crypttab_initramfs  : !!bool false

  mkinitcpio: !!map
    hooks : !!str base udev autodetect modconf block encrypt lvm2 filesystems keyboard keymap fsck

  grub_configuration  : !!str |
                        GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=UUID=7b38f0ff-08a5-463d-8c18-e4386b89721e:root:allow-discards cryptkey=rootfs:/etc/luks-keys/cryptroot.keyfile root=/dev/mapper/root loglevel=3 quiet"
                        GRUB_ENABLE_CRYPTODISK=y
