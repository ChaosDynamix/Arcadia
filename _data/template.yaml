####################################
# LUKS ON SINGLE PARTITION         #
####################################

luks_single_partition     : !!map
  init_system : !!str busybox

  partitions  : !!seq
    - !!map
      node  : !!str /dev/sda1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sda2
      type  : !!str Linux LUKS partition
      size  : !!str 100%FREE

  sgdisk    : !!str |
              $ sgdisk -o mode_sgdisk -n=2:0:0 -t=2:8309 /dev/sda

  mkinitcpio: !!map
    hooks : !!str base udev autodetect modconf block encrypt lvm2 filesystems keyboard keymap fsck

  grub_configurations : !!seq
    - !!map
      title : !!str trim
      cmd   : !!str |
              GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=UUID=7b38f0ff-08a5-463d-8c18-e4386b89721e:crypt_context_:allow-discards cryptkey=rootfs:/etc/luks-keys/crypt_context_.keyfile root=/dev/grp/root loglevel=3 quiet"
              GRUB_ENABLE_CRYPTODISK=y
    - !!map
      title : !!str no trim
      cmd   : !!str |
              GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=UUID=7b38f0ff-08a5-463d-8c18-e4386b89721e:crypt_context_ cryptkey=rootfs:/etc/luks-keys/crypt_context_.keyfile root=/dev/grp/root loglevel=3 quiet"
              GRUB_ENABLE_CRYPTODISK=y

####################################
# LUKS ON MULTIPLE PARTITIONS      #
####################################

luks_multiple_partitions  : !!map
  init_system : !!str systemd

  partitions  : !!seq
    - !!map
      node  : !!str /dev/sda1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sda2
      type  : !!str Linux LUKS partition
      size  : !!str 100%FREE
    - !!map
      node  : !!str /dev/sdb1
      type  : !!str Linux LUKS partition
      size  : !!str 100%FREE

  sgdisk    : !!str |
              $ sgdisk -o mode_sgdisk -n=2:0:0 -t=2:8309 /dev/sda
              $ sgdisk -o -n=1:0:0 -t=1:8309 /dev/sdb

  mkinitcpio: !!map
    hooks : !!str base systemd autodetect modconf block sd-encrypt sd-lvm2 filesystems keyboard sd-vconsole fsck

  grub_configurations : !!seq
    - !!map
      title : !!str trim
      cmd   : !!str |
              GRUB_CMDLINE_LINUX_DEFAULT="rd.luks.options=discard root=/dev/grp/root loglevel=3 quiet"
              GRUB_ENABLE_CRYPTODISK=y
    - !!map
      title : !!str no trim
      cmd   : !!str |
              GRUB_CMDLINE_LINUX_DEFAULT="root=/dev/grp/root loglevel=3 quiet"
              GRUB_ENABLE_CRYPTODISK=y

####################################
# LUKS ON RAID                     #
####################################

luks_raid                 : !!map
  init_system : !!str busybox

  partitions  : !!seq
    - !!map
      node  : !!str /dev/sda1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sda2
      type  : !!str Linux RAID partition
      size  : !!str 100%FREE - 100M
    - !!map
      node  : !!str /dev/sdb1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sdb2
      type  : !!str Linux RAID partition
      size  : !!str 100%FREE - 100M

  sgdisk    : !!str |
              $ sgdisk -o mode_sgdisk -n=2:0:-100M -t=2:fd00 -R=/dev/sdb /dev/sda
              $ sgdisk -G /dev/sdb

  mkinitcpio: !!map
    hooks : !!str base udev autodetect modconf block mdadm_udev encrypt lvm2 filesystems keyboard keymap fsck

  grub_configurations : !!seq
    - !!map
      title : !!str trim
      cmd   : !!str |
              GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=UUID=7b38f0ff-08a5-463d-8c18-e4386b89721e:crypt_context_:allow-discards cryptkey=rootfs:/etc/luks-keys/crypt_context_.keyfile root=/dev/grp/root loglevel=3 quiet"
              GRUB_ENABLE_CRYPTODISK=y
    - !!map
      title : !!str no trim
      cmd   : !!str |
              GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=UUID=7b38f0ff-08a5-463d-8c18-e4386b89721e:crypt_context_ cryptkey=rootfs:/etc/luks-keys/crypt_context_.keyfile root=/dev/grp/root loglevel=3 quiet"
              GRUB_ENABLE_CRYPTODISK=y

####################################
# LUKS ON LOGICAL VOLUMES          #
####################################

luks_logical_volumes      : !!map
  init_system : !!str busybox

  partitions  : !!seq
    - !!map
      node  : !!str /dev/sda1
      type  : !!str mode_partition_type
      size  : !!str mode_partition_size
    - !!map
      node  : !!str /dev/sda2
      type  : !!str Linux LVM
      size  : !!str 100%FREE
    - !!map
      node  : !!str /dev/sdb1
      type  : !!str Linux LVM
      size  : !!str 100%FREE

  sgdisk    : !!str |
              $ sgdisk -o mode_sgdisk -n=2:0:0 -t=2:8e00 /dev/sda
              $ sgdisk -o -n=1:0:0 -t=1:8e00 /dev/sdb

  mkinitcpio: !!map
    hooks : !!str base udev autodetect modconf block encrypt lvm2 filesystems keyboard keymap fsck

  grub_configurations : !!seq
    - !!map
      title : !!str trim
      cmd   : !!str |
              GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=UUID=7b38f0ff-08a5-463d-8c18-e4386b89721e:root:allow-discards cryptkey=rootfs:/etc/luks-keys/cryptroot.keyfile root=/dev/mapper/root loglevel=3 quiet"
              GRUB_ENABLE_CRYPTODISK=y
    - !!map
      title : !!str no trim
      cmd   : !!str |
              GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=/dev/grp/cryptroot:root cryptkey=rootfs:/etc/luks-keys/cryptroot.keyfile root=/dev/mapper/root loglevel=3 quiet"
              GRUB_ENABLE_CRYPTODISK=y
