####################################
# LVM ON LUKS                      #
####################################

lvm_luks  : !!map
  group   : !!str grp
  volumes : !!seq

    - !!map
      node  : !!str /dev/_grp_/root
      label : !!str ROOT
      size  : !!str "15-20 GiB"

    - !!map
      node  : !!str /dev/_grp_/swap
      label : !!str SWAP
      size  : !!str "> 512 MiB"

    - !!map
      node  : !!str /dev/_grp_/var
      label : !!str VAR
      size  : !!str "8-12 GiB"

    - !!map
      node  : !!str /dev/_grp_/home
      label : !!str HOME
      size  : !!str "100%FREE - 5 GiB"

  setup   : !!map
    steps   : !!seq

      - !!map
        id        : !!int 1
        context   : !!str volumes
        format    : !!str |
                    $ mkfs.ext4 -L ROOT /dev/grp/root
                    $ mkfs.ext4 -L VAR /dev/grp/var
                    $ mkfs.ext4 -L HOME /dev/grp/home
        mount     : !!str |
                    $ mount /dev/grp/root /mnt
                    $ mkdir /mnt/{var,home}
                    $ mount /dev/grp/var /mnt/var
                    $ mount /dev/grp/home /mnt/home
        has_swap  : !!bool true
        swap      : !!str |
                    $ mkswap -L SWAP /dev/grp/swap
                    $ swapon /dev/grp/swap

####################################
# LUKS ON LVM                      #
####################################

luks_lvm  : !!map
  group   : !!str grp
  volumes : !!seq

    - !!map
      node  : !!str /dev/_grp_/cryptroot
      label : !!str CRYPTROOT
      size  : !!str "23-32 GiB"

    - !!map
      node  : !!str /dev/_grp_/cryptswap
      label : !!str CRYPTSWAP
      size  : !!str "> 512 MiB"

    - !!map
      node  : !!str /dev/_grp_/crypthome
      label : !!str CRYPTHOME
      size  : !!str "100%FREE"

  setup   : !!map
    steps   : !!seq

      - !!map
        id        : !!int 1
        context   : !!str Root container
        format    : !!str |
                    $ mkfs.ext4 -L ROOT /dev/mapper/root
        mount     : !!str |
                    $ mount /dev/mapper/root /mnt
        has_swap  : !!bool false

      - !!map
        id        : !!int 2
        context   : !!str Home container
        format    : !!str |
                    $ mkfs.ext4 -L HOME /dev/mapper/home
        mount     : !!str |
                    $ mount /dev/mapper/home /mnt/home
        has_swap  : !!bool false
